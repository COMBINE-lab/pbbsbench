# ********************
# GENERIC MAKEFILE FOR MOST BENCHMARKS THAT LINK
# THE TIMING CODE WITH THE IMPLEMENTATION
# USES FOLLOWING DEFINITIONS
#    BENCH : the name of the benchmark
#    OBJS : implementation object files
#    REQUIRE : dependences for the object files
#    CC : the compiler
#    CFLAGS : compiler flags
#    LFLAGS : compiler link flags
# ********************

TIME = ../bench/$(BENCH)Time
CHECK = ../bench/$(BENCH)Check
INCLUDE = -Icommon -Ipbbslib

# Make benchmark
$(BENCH) : $(TIME).o $(OBJS) $(CHECK) testInputs
	$(CC) $(LFLAGS) -o $@ $(TIME).o $(OBJS) $(LIBS)

# The generic benchmark timer
$(TIME).o : $(TIME).C
	cd ../bench; make -s SATime.o

# The check code
$(CHECK) : $(CHECK).C
	cd ../bench; make -s SACheck

# object files
%.o : %.C $(REQUIRE)
	$(CC) $(CFLAGS) $(INCLUDE) -c $< -o $@

# copy over the generic test code
testInputs : ../bench/testInputs
	cp ../bench/testInputs .

clean :
	rm -f $(BENCH) *.o

cleanall : clean
	rm -f testInputs; cd ../bench; make -s clean
